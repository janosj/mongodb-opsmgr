# MongoDB Ops Manager Administration API

A sample Node.js application to deploy a MongoDB cluster using the Ops Manager Administration API. API documentation can be found [here](https://www.mongodb.com/docs/ops-manager/current/api/).


## Prerequisites

- Node.js and NPM (Node Package Manager)
- Ops Manager must be deployed in advance. 


## Deploying a Cluster

### 1. Download the Repository

```
git clone https://github.com/janosj/mongodb-opsmgr.git
```

### 2. Install Dependencies

Using a terminal window, navigate to this admin api directory and install the Node dependencies using the included NPM dependency file (*package.json*):

```shell
npm install
```

This command reads the `package.json` file and downloads and saves the dependencies defined within it to a directory called `node_modules`. It also creates a `package-lock.json` file that sets the version information for each of the modules required to build your project.

### 3. Configure Ops Manager Settings

`deployShardeCluster.js` contains a number of settings required by the API to connect to your Ops Manager instance and deploy resources. Be sure to update the OPSMGR_HOST, PROJECT_ID, OM_USER, and PUBLIC_API_KEY accordingly. Also note that the cluster configuration file contains hardcoded server names. You can either deploy a 3-node Ops Manager system using the included Docker scripts, or adjust the configuration file to match your environment.

### 4. Deploy the Cluster

Deploy the cluster by running the Node.js application:

```
node deployShardedCluster.js
```

The application should return immediately and, likewise, the cluster should be immediately listed in the Deployment section of the Ops Manager UI. In a few seconds or minutes, the cluster will be deployed, primaries will be elected, and the cluster will become available for use. 

## Example Cluster Configuration

The example configuration is a Sharded cluster containing 2 shards, using single-node replica sets for both shards as well as the Config Server Replica Set. This was designed to consume a minimum of resources for demonstration purposes only and should not be used in production. The config file was generated by exporting the configuration of a deployed cluster. Using the Ops Manager UI, the deployment of this cluster would look as follows:

<img src="images/deploying-the-cluster.png" alt="Deploying the cluster with Ops Manager"/>

The deployed cluster, as configured in `clusterConfig.json`, looks like this:

<img src="images/deployed-cluster.png" alt="Example cluster deployed to Ops Manager"/>


